<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1891px" preserveAspectRatio="none" style="width:1707px;height:1891px;background:#FFFFFF;" version="1.1" viewBox="0 0 1707 1891" width="1707px" zoomAndPan="magnify"><defs><filter height="300%" id="f6iuxq4k6t1a5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="51.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="167.5" y="57.9766"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="1753.2324" style="stroke:#A80036;stroke-width:1.0;" width="10" x="462" y="79.2871"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="493.2344" style="stroke:#000000;stroke-width:2.0;" width="844" x="320" y="124.2871"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="254.75" style="stroke:#000000;stroke-width:2.0;" width="824" x="330" y="207.2188"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="194.1289" style="stroke:#000000;stroke-width:2.0;" width="804" x="340" y="231.5293"/><rect fill="#FFFFFF" height="118.1973" style="stroke:none;stroke-width:1.0;" width="804" x="340" y="307.4609"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="134.5527" style="stroke:#000000;stroke-width:2.0;" width="804" x="340" y="475.9688"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="450.2793" style="stroke:#000000;stroke-width:2.0;" width="1108" x="320" y="631.5215"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="149.8633" style="stroke:#000000;stroke-width:2.0;" width="1078" x="340" y="655.832"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="255.1055" style="stroke:#000000;stroke-width:2.0;" width="824" x="330" y="819.6953"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="120.5527" style="stroke:#000000;stroke-width:2.0;" width="804" x="340" y="888.627"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="235.7949" style="stroke:#000000;stroke-width:2.0;" width="1098" x="330" y="1095.8008"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="204.4844" style="stroke:#000000;stroke-width:2.0;" width="1078" x="340" y="1120.1113"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="270.75" style="stroke:#000000;stroke-width:2.0;" width="1373" x="320" y="1345.5957"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="239.4395" style="stroke:#000000;stroke-width:2.0;" width="1353" x="330" y="1369.9063"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="178.8184" style="stroke:#000000;stroke-width:2.0;" width="1333" x="340" y="1423.5273"/><rect fill="#FFFFFF" height="44.2656" style="stroke:none;stroke-width:1.0;" width="1333" x="340" y="1558.0801"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="195.1738" style="stroke:#000000;stroke-width:2.0;" width="982" x="330" y="1630.3457"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="163.8633" style="stroke:#000000;stroke-width:2.0;" width="962" x="340" y="1654.6563"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="172" x2="172" y1="47.9766" y2="1842.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="467" x2="467" y1="47.9766" y2="1842.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="673" x2="673" y1="47.9766" y2="1842.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="822" x2="822" y1="47.9766" y2="1842.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="929" x2="929" y1="47.9766" y2="1842.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1054" x2="1054" y1="47.9766" y2="1842.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1218" x2="1218" y1="47.9766" y2="1842.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1355" x2="1355" y1="47.9766" y2="1842.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1540" x2="1540" y1="47.9766" y2="1842.5195"/><path d="M10,5 L335,5 C340,5 340,26.4883 340,26.4883 C340,26.4883 340,47.9766 335,47.9766 L10,47.9766 C5,47.9766 5,26.4883 5,26.4883 C5,26.4883 5,5 10,5 " fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M335,5 C330,5 330,26.4883 330,26.4883 C330,47.9766 335,47.9766 335,47.9766 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="151.5" y="23.5352">WMS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="315" x="10" y="40.0234">ID.JENIUS.INVESTMENT.TRANSACTION.STATUS</text><path d="M10,1841.5195 L335,1841.5195 C340,1841.5195 340,1863.0078 340,1863.0078 C340,1863.0078 340,1884.4961 335,1884.4961 L10,1884.4961 C5,1884.4961 5,1863.0078 5,1863.0078 C5,1863.0078 5,1841.5195 10,1841.5195 " fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M335,1841.5195 C330,1841.5195 330,1863.0078 330,1863.0078 C330,1884.4961 335,1884.4961 335,1884.4961 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="151.5" y="1860.0547">WMS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="315" x="10" y="1876.543">ID.JENIUS.INVESTMENT.TRANSACTION.STATUS</text><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="230" x="350" y="12.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="216" x="357" y="33.0234">worker-investment-transaction</text><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="230" x="350" y="1841.5195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="216" x="357" y="1862.0547">worker-investment-transaction</text><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="154" x="594" y="12.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="601" y="33.0234">ms-user-preference</text><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="154" x="594" y="1841.5195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="601" y="1862.0547">ms-user-preference</text><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="117" x="762" y="12.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="769" y="33.0234">ms-investment</text><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="117" x="762" y="1841.5195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="769" y="1862.0547">ms-investment</text><path d="M898,21.4883 L960,21.4883 C965,21.4883 965,34.7324 965,34.7324 C965,34.7324 965,47.9766 960,47.9766 L898,47.9766 C893,47.9766 893,34.7324 893,34.7324 C893,34.7324 893,21.4883 898,21.4883 " fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M960,21.4883 C955,21.4883 955,34.7324 955,34.7324 C955,47.9766 960,47.9766 960,47.9766 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="898" y="40.0234">j2notify</text><path d="M898,1841.5195 L960,1841.5195 C965,1841.5195 965,1854.7637 965,1854.7637 C965,1854.7637 965,1868.0078 960,1868.0078 L898,1868.0078 C893,1868.0078 893,1854.7637 893,1854.7637 C893,1854.7637 893,1841.5195 898,1841.5195 " fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M960,1841.5195 C955,1841.5195 955,1854.7637 955,1854.7637 C955,1868.0078 960,1868.0078 960,1868.0078 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="898" y="1860.0547">j2notify</text><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="151" x="979" y="8.4883"/><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="151" x="975" y="12.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="982" y="33.0234">inflightTransactions</text><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="151" x="979" y="1841.5195"/><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="151" x="975" y="1845.5195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="982" y="1866.0547">inflightTransactions</text><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="140" x="1148" y="8.4883"/><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="140" x="1144" y="12.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="1151" y="33.0234">failedTransactions</text><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="140" x="1148" y="1841.5195"/><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="140" x="1144" y="1845.5195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="1151" y="1866.0547">failedTransactions</text><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="98" x="1306" y="8.4883"/><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="98" x="1302" y="12.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1309" y="33.0234">transactions</text><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="98" x="1306" y="1841.5195"/><rect fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="98" x="1302" y="1845.5195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1309" y="1866.0547">transactions</text><path d="M1423,21.4883 L1658,21.4883 C1663,21.4883 1663,34.7324 1663,34.7324 C1663,34.7324 1663,47.9766 1658,47.9766 L1423,47.9766 C1418,47.9766 1418,34.7324 1418,34.7324 C1418,34.7324 1418,21.4883 1423,21.4883 " fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1658,21.4883 C1653,21.4883 1653,34.7324 1653,34.7324 C1653,47.9766 1658,47.9766 1658,47.9766 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="225" x="1423" y="40.0234">ID.JENIUS.INVESTMENT.REVERSAL</text><path d="M1423,1841.5195 L1658,1841.5195 C1663,1841.5195 1663,1854.7637 1663,1854.7637 C1663,1854.7637 1663,1868.0078 1658,1868.0078 L1423,1868.0078 C1418,1868.0078 1418,1854.7637 1418,1854.7637 C1418,1854.7637 1418,1841.5195 1423,1841.5195 " fill="#FEFECE" filter="url(#f6iuxq4k6t1a5)" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1658,1841.5195 C1653,1841.5195 1653,1854.7637 1653,1854.7637 C1653,1868.0078 1658,1868.0078 1658,1868.0078 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="225" x="1423" y="1860.0547">ID.JENIUS.INVESTMENT.REVERSAL</text><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="51.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="167.5" y="57.9766"/><rect fill="#FFFFFF" filter="url(#f6iuxq4k6t1a5)" height="1753.2324" style="stroke:#A80036;stroke-width:1.0;" width="10" x="462" y="79.2871"/><polygon fill="#A80036" points="450,75.2871,460,79.2871,450,83.2871,454,79.2871" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="177.5" x2="456" y1="79.2871" y2="79.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="184.5" y="74.5449">consume transaction status</text><path d="M320,124.2871 L475,124.2871 L475,131.2871 L465,141.2871 L320,141.2871 L320,124.2871 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="493.2344" style="stroke:#000000;stroke-width:2.0;" width="844" x="320" y="124.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="110" x="335" y="137.8555">status=VERIFIED</text><polygon fill="#A80036" points="661,158.9082,671,162.9082,661,166.9082,665,162.9082" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="667" y1="162.9082" y2="162.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="479" y="158.166">GET /profile</text><polygon fill="#A80036" points="483,188.2188,473,192.2188,483,196.2188,479,192.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="477" x2="1053.5" y1="192.2188" y2="192.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="489" y="187.4766">find by cif,referenceNo</text><path d="M330,207.2188 L440,207.2188 L440,214.2188 L430,224.2188 L330,224.2188 L330,207.2188 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="254.75" style="stroke:#000000;stroke-width:2.0;" width="824" x="330" y="207.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="345" y="220.7871">type=SUB</text><path d="M340,231.5293 L402,231.5293 L402,238.5293 L392,248.5293 L340,248.5293 L340,231.5293 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="194.1289" style="stroke:#000000;stroke-width:2.0;" width="804" x="340" y="231.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="355" y="245.0977">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="100" x="417" y="244.1641">[if inflight found]</text><polygon fill="#A80036" points="810.5,266.1504,820.5,270.1504,810.5,274.1504,814.5,270.1504" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="816.5" y1="270.1504" y2="270.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="479" y="265.4082">GET /portfolios/:goalCode</text><polygon fill="#A80036" points="1042.5,295.4609,1052.5,299.4609,1042.5,303.4609,1046.5,299.4609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1048.5" y1="299.4609" y2="299.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="479" y="294.7188">update status=VERIFIED</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="340" x2="1144" y1="308.4609" y2="308.4609"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="63" x="345" y="319.0957">[not found]</text><polygon fill="#A80036" points="810.5,339.7266,820.5,343.7266,810.5,347.7266,814.5,343.7266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="816.5" y1="343.7266" y2="343.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="479" y="338.9844">GET /products/:productCode</text><polygon fill="#A80036" points="810.5,369.0371,820.5,373.0371,810.5,377.0371,814.5,373.0371" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="816.5" y1="373.0371" y2="373.0371"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="479" y="368.2949">GET /portfolios/:goalCode</text><polygon fill="#A80036" points="1042.5,413.6582,1052.5,417.6582,1042.5,421.6582,1046.5,417.6582" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1048.5" y1="417.6582" y2="417.6582"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="479" y="397.6055">create inflight data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="479" y="412.916">add field fromBranch=true</text><polygon fill="#A80036" points="917,449.9688,927,453.9688,917,457.9688,921,453.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="923" y1="453.9688" y2="453.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="479" y="449.2266">send notification</text><path d="M340,475.9688 L452,475.9688 L452,482.9688 L442,492.9688 L340,492.9688 L340,475.9688 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="134.5527" style="stroke:#000000;stroke-width:2.0;" width="804" x="340" y="475.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="355" y="489.5371">type=RED</text><polygon fill="#A80036" points="810.5,510.5898,820.5,514.5898,810.5,518.5898,814.5,514.5898" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="816.5" y1="514.5898" y2="514.5898"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="479" y="509.8477">GET /portfolios/:goalCode</text><polygon fill="#A80036" points="1042.5,539.9004,1052.5,543.9004,1042.5,547.9004,1046.5,543.9004" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1048.5" y1="543.9004" y2="543.9004"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="479" y="539.1582">update status=VERIFIED</text><polygon fill="#A80036" points="810.5,569.2109,820.5,573.2109,810.5,577.2109,814.5,573.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="816.5" y1="573.2109" y2="573.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="479" y="568.4688">delete portfolios cache</text><polygon fill="#A80036" points="917,598.5215,927,602.5215,917,606.5215,921,602.5215" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="923" y1="602.5215" y2="602.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="479" y="597.7793">send notification</text><path d="M320,631.5215 L489,631.5215 L489,638.5215 L479,648.5215 L320,648.5215 L320,631.5215 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="450.2793" style="stroke:#000000;stroke-width:2.0;" width="1108" x="320" y="631.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="124" x="335" y="645.0898">status=APPROVED</text><path d="M340,655.832 L450,655.832 L450,662.832 L440,672.832 L340,672.832 L340,655.832 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="149.8633" style="stroke:#000000;stroke-width:2.0;" width="1078" x="340" y="655.832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="355" y="669.4004">type=SUB</text><polygon fill="#A80036" points="483,690.4531,473,694.4531,483,698.4531,479,694.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="477" x2="1053.5" y1="694.4531" y2="694.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="489" y="689.7109">find by cif,referenceNo</text><polygon fill="#A80036" points="1042.5,735.0742,1052.5,739.0742,1042.5,743.0742,1046.5,739.0742" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1048.5" y1="739.0742" y2="739.0742"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="479" y="719.0215">update inflight status=APPROVED</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="479" y="734.332">add field expiredAt</text><polygon fill="#A80036" points="1343,764.3848,1353,768.3848,1343,772.3848,1347,768.3848" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1349" y1="768.3848" y2="768.3848"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="479" y="763.6426">insert transaction data</text><polygon fill="#A80036" points="917,793.6953,927,797.6953,917,801.6953,921,797.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="923" y1="797.6953" y2="797.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="479" y="792.9531">send notification</text><path d="M330,819.6953 L442,819.6953 L442,826.6953 L432,836.6953 L330,836.6953 L330,819.6953 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="255.1055" style="stroke:#000000;stroke-width:2.0;" width="824" x="330" y="819.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="345" y="833.2637">type=RED</text><polygon fill="#A80036" points="483,869.627,473,873.627,483,877.627,479,873.627" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="477" x2="1053.5" y1="873.627" y2="873.627"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="489" y="853.5742">find by cif and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="489" y="868.8848">referenceNo=TransactionID from kafka</text><path d="M340,888.627 L407,888.627 L407,895.627 L397,905.627 L340,905.627 L340,888.627 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="120.5527" style="stroke:#000000;stroke-width:2.0;" width="804" x="340" y="888.627"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="355" y="902.1953">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="122" x="422" y="901.2617">[if inflight not found]</text><polygon fill="#A80036" points="810.5,923.248,820.5,927.248,810.5,931.248,814.5,927.248" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="816.5" y1="927.248" y2="927.248"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="479" y="922.5059">GET /products/:productCode</text><polygon fill="#A80036" points="810.5,952.5586,820.5,956.5586,810.5,960.5586,814.5,956.5586" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="816.5" y1="956.5586" y2="956.5586"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="479" y="951.8164">GET /portfolios/:goalCode</text><polygon fill="#A80036" points="1042.5,997.1797,1052.5,1001.1797,1042.5,1005.1797,1046.5,1001.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1048.5" y1="1001.1797" y2="1001.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="479" y="981.127">create inflight data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="479" y="996.4375">add field fromBranch=true</text><polygon fill="#A80036" points="917,1033.4902,927,1037.4902,917,1041.4902,921,1037.4902" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="923" y1="1037.4902" y2="1037.4902"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="479" y="1032.748">send notification</text><polygon fill="#A80036" points="810.5,1062.8008,820.5,1066.8008,810.5,1070.8008,814.5,1066.8008" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="816.5" y1="1066.8008" y2="1066.8008"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="479" y="1062.0586">delete portfolios cache</text><path d="M330,1095.8008 L485,1095.8008 L485,1102.8008 L475,1112.8008 L330,1112.8008 L330,1095.8008 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="235.7949" style="stroke:#000000;stroke-width:2.0;" width="1098" x="330" y="1095.8008"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="110" x="345" y="1109.3691">status=SETTLED</text><path d="M340,1120.1113 L452,1120.1113 L452,1127.1113 L442,1137.1113 L340,1137.1113 L340,1120.1113 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="204.4844" style="stroke:#000000;stroke-width:2.0;" width="1078" x="340" y="1120.1113"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="355" y="1133.6797">type=RED</text><polygon fill="#A80036" points="483,1167.3877,473,1171.3877,483,1175.3877,479,1171.3877" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="477" x2="1053.5" y1="1171.3877" y2="1171.3877"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="489" y="1166.6455">find by cif,referenceNo</text><path d="M1059,1142.4219 L1059,1182.4219 L1299,1182.4219 L1299,1152.4219 L1289,1142.4219 L1059,1142.4219 " fill="#FBFB77" filter="url(#f6iuxq4k6t1a5)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1289,1142.4219 L1289,1152.4219 L1299,1152.4219 L1289,1142.4219 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="1065" y="1159.9902">if not found, find by TransactionID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="1065" y="1175.3008">and repeat process below</text><polygon fill="#A80036" points="1042.5,1224.6641,1052.5,1228.6641,1042.5,1232.6641,1046.5,1228.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1048.5" y1="1228.6641" y2="1228.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="479" y="1208.6113">update inflight status=APPROVED</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="479" y="1223.9219">add field expiredAt</text><polygon fill="#A80036" points="1343,1253.9746,1353,1257.9746,1343,1261.9746,1347,1257.9746" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1349" y1="1257.9746" y2="1257.9746"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="479" y="1253.2324">insert transaction data</text><polygon fill="#A80036" points="917,1283.2852,927,1287.2852,917,1291.2852,921,1287.2852" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="923" y1="1287.2852" y2="1287.2852"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="479" y="1282.543">send notification</text><polygon fill="#A80036" points="810.5,1312.5957,820.5,1316.5957,810.5,1320.5957,814.5,1316.5957" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="816.5" y1="1316.5957" y2="1316.5957"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="479" y="1311.8535">delete portfolios cache</text><path d="M320,1345.5957 L495,1345.5957 L495,1352.5957 L485,1362.5957 L320,1362.5957 L320,1345.5957 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="270.75" style="stroke:#000000;stroke-width:2.0;" width="1373" x="320" y="1345.5957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="130" x="335" y="1359.1641">status=UNVERIFIED</text><path d="M330,1369.9063 L440,1369.9063 L440,1376.9063 L430,1386.9063 L330,1386.9063 L330,1369.9063 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="239.4395" style="stroke:#000000;stroke-width:2.0;" width="1353" x="330" y="1369.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="345" y="1383.4746">type=SUB</text><polygon fill="#A80036" points="483,1404.5273,473,1408.5273,483,1412.5273,479,1408.5273" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="477" x2="1053.5" y1="1408.5273" y2="1408.5273"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="411" x="489" y="1403.7852">find by cif, referenceNo = RefNo (first 12 digits) or TransactionID</text><path d="M340,1423.5273 L402,1423.5273 L402,1430.5273 L392,1440.5273 L340,1440.5273 L340,1423.5273 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="178.8184" style="stroke:#000000;stroke-width:2.0;" width="1333" x="340" y="1423.5273"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="355" y="1437.0957">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="105" x="417" y="1436.1621">[fromBranch=true]</text><polygon fill="#A80036" points="1042.5,1458.1484,1052.5,1462.1484,1042.5,1466.1484,1046.5,1462.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1048.5" y1="1462.1484" y2="1462.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271" x="479" y="1457.4063">update status=DELETED and add expiredAt</text><polygon fill="#A80036" points="810.5,1487.459,820.5,1491.459,810.5,1495.459,814.5,1491.459" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="816.5" y1="1491.459" y2="1491.459"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="479" y="1486.7168">delete portfolios cache</text><polygon fill="#A80036" points="1206,1516.7695,1216,1520.7695,1206,1524.7695,1210,1520.7695" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1212" y1="1520.7695" y2="1520.7695"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="479" y="1516.0273">insert failed transaction</text><polygon fill="#A80036" points="917,1546.0801,927,1550.0801,917,1554.0801,921,1550.0801" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="923" y1="1550.0801" y2="1550.0801"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="479" y="1545.3379">send notification</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="340" x2="1673" y1="1559.0801" y2="1559.0801"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="75" x="345" y="1569.7148">[from Jenius]</text><polygon fill="#A80036" points="1528.5,1590.3457,1538.5,1594.3457,1528.5,1598.3457,1532.5,1594.3457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1534.5" y1="1594.3457" y2="1594.3457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="479" y="1589.6035">publish reversal {cif,referenceNo}</text><path d="M330,1630.3457 L487,1630.3457 L487,1637.3457 L477,1647.3457 L330,1647.3457 L330,1630.3457 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="195.1738" style="stroke:#000000;stroke-width:2.0;" width="982" x="330" y="1630.3457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="112" x="345" y="1643.9141">status=DELETED</text><path d="M340,1654.6563 L452,1654.6563 L452,1661.6563 L442,1671.6563 L340,1671.6563 L340,1654.6563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="163.8633" style="stroke:#000000;stroke-width:2.0;" width="962" x="340" y="1654.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="355" y="1668.2246">type=RED</text><polygon fill="#A80036" points="483,1689.2773,473,1693.2773,483,1697.2773,479,1693.2773" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="477" x2="1053.5" y1="1693.2773" y2="1693.2773"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="411" x="489" y="1688.5352">find by cif, referenceNo = RefNo (first 12 digits) or TransactionID</text><polygon fill="#A80036" points="1042.5,1718.5879,1052.5,1722.5879,1042.5,1726.5879,1046.5,1722.5879" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1048.5" y1="1722.5879" y2="1722.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271" x="479" y="1717.8457">update status=DELETED and add expiredAt</text><polygon fill="#A80036" points="810.5,1747.8984,820.5,1751.8984,810.5,1755.8984,814.5,1751.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="816.5" y1="1751.8984" y2="1751.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="479" y="1747.1563">delete portfolios cache</text><polygon fill="#A80036" points="1206,1777.209,1216,1781.209,1206,1785.209,1210,1781.209" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="1212" y1="1781.209" y2="1781.209"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="479" y="1776.4668">insert failed transaction</text><polygon fill="#A80036" points="917,1806.5195,927,1810.5195,917,1814.5195,921,1810.5195" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472" x2="923" y1="1810.5195" y2="1810.5195"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="479" y="1805.7773">send notification</text><!--MD5=[a6fdf325fb6af74ac001f10d4bf588a1]
@startuml transaction status
queue "WMS\nID.JENIUS.INVESTMENT.TRANSACTION.STATUS" as kafka
participant "worker-investment-transaction" as wit
participant "ms-user-preference" as mup
participant "ms-investment" as mi
queue "j2notify" as notif
collections "inflightTransactions" as inflights
collections "failedTransactions" as faileds
collections "transactions" as transactions
queue "ID.JENIUS.INVESTMENT.REVERSAL" as kafkaReversal

activate kafka
kafka -> wit: consume transaction status
activate wit
deactivate kafka
' VERIFIED
group status=VERIFIED
wit -> mup: GET /profile
wit <- inflights: find by cif,referenceNo
' VERIFIED SUB
group type=SUB
alt if inflight found
wit -> mi: GET /portfolios/:goalCode
wit -> inflights: update status=VERIFIED
else not found
wit -> mi: GET /products/:productCode
wit -> mi: GET /portfolios/:goalCode
wit -> inflights: create inflight data\nadd field fromBranch=true
end
wit -> notif: send notification
end
' VERIFIED SUB end
' VERIFIED RED
group type=RED
wit -> mi: GET /portfolios/:goalCode
wit -> inflights: update status=VERIFIED
wit -> mi: delete portfolios cache
wit -> notif: send notification
end
' VERIFIED RED end
end
' VERIFIED end
' APPROVED
group status=APPROVED
' APPROVED SUB
group type=SUB
wit <- inflights: find by cif,referenceNo
wit -> inflights: update inflight status=APPROVED\nadd field expiredAt
wit -> transactions: insert transaction data
wit -> notif: send notification
end
' APPROVED SUB end
' APPROVED RED
group type=RED
wit <- inflights: find by cif and\nreferenceNo=TransactionID from kafka
opt if inflight not found
wit -> mi: GET /products/:productCode
wit -> mi: GET /portfolios/:goalCode
wit -> inflights: create inflight data\nadd field fromBranch=true
end
wit -> notif: send notification
wit -> mi: delete portfolios cache
end
' APPROVED RED end
end
' APPROVED end
' SETTLED
group status=SETTLED
' SETTLED RED
group type=RED
wit <- inflights: find by cif,referenceNo
note right: if not found, find by TransactionID\nand repeat process below
wit -> inflights: update inflight status=APPROVED\nadd field expiredAt
wit -> transactions: insert transaction data
wit -> notif: send notification
wit -> mi: delete portfolios cache
end
' SETTLED RED end
end
' SETTLED end
' UNVERIFIED
group status=UNVERIFIED
' UNVERIFIED SUB
group type=SUB
wit <- inflights: find by cif, referenceNo = RefNo (first 12 digits) or TransactionID
alt fromBranch=true
wit -> inflights: update status=DELETED and add expiredAt
wit -> mi: delete portfolios cache
wit -> faileds: insert failed transaction
wit -> notif: send notification
else from Jenius
wit -> kafkaReversal: publish reversal {cif,referenceNo}
end
end
' UNVERIFIED SUB end
end
' UNVERIFIED end
' UNVERIFIED
group status=DELETED
' DELETED RED
group type=RED
wit <- inflights: find by cif, referenceNo = RefNo (first 12 digits) or TransactionID
wit -> inflights: update status=DELETED and add expiredAt
wit -> mi: delete portfolios cache
wit -> faileds: insert failed transaction
wit -> notif: send notification
end
' DELETED RED end
end
' DELETED end
deactivate wit

@enduml

@startuml transaction status
queue "WMS\nID.JENIUS.INVESTMENT.TRANSACTION.STATUS" as kafka
participant "worker-investment-transaction" as wit
participant "ms-user-preference" as mup
participant "ms-investment" as mi
queue "j2notify" as notif
collections "inflightTransactions" as inflights
collections "failedTransactions" as faileds
collections "transactions" as transactions
queue "ID.JENIUS.INVESTMENT.REVERSAL" as kafkaReversal

activate kafka
kafka -> wit: consume transaction status
activate wit
deactivate kafka
group status=VERIFIED
wit -> mup: GET /profile
wit <- inflights: find by cif,referenceNo
group type=SUB
alt if inflight found
wit -> mi: GET /portfolios/:goalCode
wit -> inflights: update status=VERIFIED
else not found
wit -> mi: GET /products/:productCode
wit -> mi: GET /portfolios/:goalCode
wit -> inflights: create inflight data\nadd field fromBranch=true
end
wit -> notif: send notification
end
group type=RED
wit -> mi: GET /portfolios/:goalCode
wit -> inflights: update status=VERIFIED
wit -> mi: delete portfolios cache
wit -> notif: send notification
end
end
group status=APPROVED
group type=SUB
wit <- inflights: find by cif,referenceNo
wit -> inflights: update inflight status=APPROVED\nadd field expiredAt
wit -> transactions: insert transaction data
wit -> notif: send notification
end
group type=RED
wit <- inflights: find by cif and\nreferenceNo=TransactionID from kafka
opt if inflight not found
wit -> mi: GET /products/:productCode
wit -> mi: GET /portfolios/:goalCode
wit -> inflights: create inflight data\nadd field fromBranch=true
end
wit -> notif: send notification
wit -> mi: delete portfolios cache
end
end
group status=SETTLED
group type=RED
wit <- inflights: find by cif,referenceNo
note right: if not found, find by TransactionID\nand repeat process below
wit -> inflights: update inflight status=APPROVED\nadd field expiredAt
wit -> transactions: insert transaction data
wit -> notif: send notification
wit -> mi: delete portfolios cache
end
end
group status=UNVERIFIED
group type=SUB
wit <- inflights: find by cif, referenceNo = RefNo (first 12 digits) or TransactionID
alt fromBranch=true
wit -> inflights: update status=DELETED and add expiredAt
wit -> mi: delete portfolios cache
wit -> faileds: insert failed transaction
wit -> notif: send notification
else from Jenius
wit -> kafkaReversal: publish reversal {cif,referenceNo}
end
end
end
group status=DELETED
group type=RED
wit <- inflights: find by cif, referenceNo = RefNo (first 12 digits) or TransactionID
wit -> inflights: update status=DELETED and add expiredAt
wit -> mi: delete portfolios cache
wit -> faileds: insert failed transaction
wit -> notif: send notification
end
end
deactivate wit

@enduml

PlantUML version 1.2022.0(Tue Jan 11 23:16:42 WIB 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>