@startuml boBannerPlan
actor "User" as user
participant "MA(DBANKPRO)" as ma
participant "MS(Dashboard)" as ms
collections "Redis" as redis
database "OMNIDB" as db
participant "MS(Banner)" as msb
participant "Strapi" as strapi
participant "DCW" as dcw
actor "Admin Maker" as maker
actor "Admin Checker" as checker

activate maker
maker -> dcw: Upload banner image
activate dcw
return imageURL
deactivate dcw
maker -> strapi: Create/manage banner
deactivate maker
activate strapi

activate checker
checker -> strapi: Publish banner changes
deactivate checker

strapi -> msb: Webhook publish banners\nAPI /deleteCache
activate msb
msb -> strapi: Get all banners
strapi --> msb: Response banners data and order
deactivate strapi
msb -> redis: Refresh banners cache
msb -> db: Refresh banners and increase version
deactivate msb

activate user
user -> ma: Open login page
activate ma
note over ma
Login page
end note
ma -> ms: Get Login NTB Banners\nwith saved version
activate ms
ms -> redis: Get cached login banners
opt if redis not exists
ms -> db: Query login NTB banners
ms -> redis: Refresh banners cache
end
return Login Banners response
deactivate ms
opt if version increased
ma -> ma: Save NTB banner to local storage\n__NTB_MOBILE_BANNER_DETALS__
end

alt if inactive user (NTB)
ma --> user: Show Login NTB Banners
else if active user (ETB) AND\nlocal storage exists with key __USER_BANNER_DETALS__
ma --> user: Show Login ETB Banners
end

user -> ma: Login and Navigate to Dashboard

note over ma
Dashboard page
end note
ma -> ms: Get Dashboard Banners /promoContent
activate ms
ms -> redis: Get cached dashboard banners
opt if redis not exists
ms -> db: Query dashboard banners
ms -> redis: Refresh banners cache
end
return Dashboard Banners response
ma --> user: Show Dashboard Banners
deactivate ms

ma -> ms: Get Login ETB Banners /loginContent\n//isMobileDevice=true//
activate ms
ms -> redis: Get cached login ETB banners
opt if redis not exists
ms -> db: Query login ETB banners
ms -> redis: Refresh banners cache
end
return Login ETB Banners response
deactivate ms
opt if version increased
ma -> ma: Save ETB banner to local storage\n__USER_BANNER_DETALS__
end

deactivate ma
deactivate user